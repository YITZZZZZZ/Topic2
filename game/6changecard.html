<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>遊戲介面</title>
    <link rel="stylesheet" href="static/style4.css"> <!-- 引入CSS -->
    <style>
        .matched {
            background-color: lightgreen;
            font-weight: bold;
            color: black;
            cursor: default;
        }

        /* ✅ 提示鍵固定右上角 */
        #hintButton {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 18px;
            padding: 10px 20px;
            background-color: orange;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #hintButton:disabled {
            background-color: lightgray;
            cursor: not-allowed;
        }

        #timer1 {
            font-size: 20px;
            text-align: center;
            margin-top: 10px;
            display: block;
        }

        #timer2 {
            font-size: 20px;
            text-align: center;
            margin-top: 10px;
            display: block;
        }
    </style>
</head>
<body onload="previewAllCards()">
    <div id="timer-container" style="display:none;">
        時間: <span id="timer2">0</span> 秒<br>
        翻開提醒次數: <span id="count2">0</span> 次
    </div>

    <!-- 主要大字倒數/提示文字 -->
    <span id="timer1" style="font-size: 64px; font-weight: bold; text-align: center;display:none;"></span>

    <form>
        <input type="button" class="card-button" id="option1" value="?">
        <input type="button" class="card-button" id="option2" value="?">
        <input type="button" class="card-button" id="option3" value="?">
        <input type="button" class="card-button" id="option4" value="?">
        <input type="button" class="card-button" id="option5" value="?">
        <input type="button" class="card-button" id="option6" value="?">
        <input type="button" class="card-button" id="option7" value="?">
        <input type="button" class="card-button" id="option8" value="?">
        <input type="button" class="card-button" id="option9" value="?">
        <input type="button" class="card-button" id="option10" value="?">
        <input type="button" class="card-button" id="option11" value="?">
        <input type="button" class="card-button" id="option12" value="?">
    </form>

    <button id="hintButton" disabled>提示鍵</button>

    <div id="gameOverScreen" style="display: none; text-align: center;">
        <h2>時間到！遊戲結束！</h2>
    </div>

<script>
    const emojis = ['🍎', '🍌', '🍎', '🍌','🍐','🍐','🍋','🍋','🍉','🍉','🍇','🍇'];
    const buttons = [];
    for(let i=1; i<=12; i++) {
        buttons.push(document.getElementById("option"+i));
    }

    buttons.forEach((btn, i) => {
        btn.addEventListener("click", () => startGame(btn, i));
    });

    function shuffle(array){
        for(let i=array.length-1; i>0; i--){
            let j = Math.floor(Math.random()*(i+1));
            [array[i], array[j]] = [array[j], array[i]]; //互換牌
        }
        return array;
    }

    let shuffled = shuffle([...emojis]); // 複製避免污染原陣列

    var card = [];
    var card2 = [];
    var matchedCount = 0; 
    var count; // 提醒次數
    let interval;
    let countdown = 0;
    let isRevealing = false;
    const hintButton = document.getElementById("hintButton");

    // 載入提醒次數，且初始化顯示在 count2（跟HTML一致）
    if (localStorage.getItem("reminderCount")) {
        count = parseInt(localStorage.getItem("reminderCount"));
    }
    document.getElementById("count2").innerText = count;

    // 提示按鈕倒數計時
    function startHintCountdown() {
        let hintCountdown = 20;
        hintButton.disabled = true;
        hintButton.innerText = `提示倒數：${hintCountdown}秒`;

        const hintTimer = setInterval(() => {
            hintCountdown--;
            hintButton.innerText = `提示倒數：${hintCountdown}秒`;
            if (hintCountdown <= 0) {
                clearInterval(hintTimer);
                hintButton.innerText = "顯示提示";
                hintButton.disabled = false;
            }
        }, 1000);
    }

    // 預覽所有卡片，5秒記憶倒數
    function previewAllCards() {
        shuffled = shuffle([...emojis]); // 每輪重洗
        buttons.forEach((btn, i) => {
            btn.value = shuffled[i];
            btn.disabled = true;
        });

        let previewCountdown = 5;
        // 使用 timer1 顯示倒數時間
        document.getElementById("timer1").innerText = "記憶倒數時間: " + previewCountdown;

        const previewInterval = setInterval(() => {
            previewCountdown--;
            document.getElementById("timer1").innerText = "記憶倒數時間: " + previewCountdown;

            if (previewCountdown === 0) {
                clearInterval(previewInterval);
                document.getElementById("timer1").innerText = "遊戲開始!!!";

                buttons.forEach((btn) => {
                    btn.value = "?";
                    btn.disabled = false;
                });

                countdown = 0;
                // 使用 timer2 顯示遊戲經過秒數
                document.getElementById("timer2").innerText = countdown;

                interval = setInterval(() => {
                    countdown++;
                    document.getElementById("timer2").innerText = countdown;
                }, 1000);

                // 啟動提示倒數計時按鈕
                startHintCountdown();
            }
        }, 1000);
    }

    function startGame(button, index) {
        if (isRevealing) return;  // 提示期間禁止翻牌
        if (card.length < 2 && !card2.includes(button)) {
            button.value = shuffled[index];
            card.push(shuffled[index]);
            card2.push(button);

            if (card.length === 2) {
                setTimeout(function () {
                    if (card[0] === card[1]) {
                        card2[0].disabled = true;
                        card2[1].disabled = true;

                        card2[0].classList.add("matched");
                        card2[1].classList.add("matched");

                        matchedCount += 2;

                        if (matchedCount === emojis.length) {
                            clearInterval(interval);
                            localStorage.setItem("reminderCount", count);
			    localStorage.setItem("reminderTime2", countdown);
                            location.href = "8changecard.html"; // 可換成你想跳轉的頁面
                        }
                    } else {
                        card2[0].value = "?";
                        card2[1].value = "?";
                    }
                    card = [];
                    card2 = [];
                }, 500);
            }
        }
    }

    hintButton.addEventListener("click", () => {
        if (isRevealing) return;  // 避免重複點擊

        isRevealing = true;
        count++;
        document.getElementById("count2").innerText = count; // 更新提醒次數顯示
        localStorage.setItem("reminderCount", count);

        buttons.forEach((btn, index) => {
            if (!btn.classList.contains("matched")) {
                btn.value = shuffled[index];
                btn.disabled = true;
                btn.style.backgroundColor = "#6495ED";
                btn.style.color = "black";
            }
        });

        setTimeout(() => {
            buttons.forEach((btn, index) => {
                if (!btn.classList.contains("matched")) {
                    btn.value = "?";
                    btn.disabled = false;
                    btn.style.backgroundColor = "";
                    btn.style.color = "";
                }
            });
            isRevealing = false;
            startHintCountdown(); // 重啟倒數計時
        }, 5000);
    });
</script>
</body>
</html>

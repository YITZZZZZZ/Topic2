<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>éŠæˆ²ä»‹é¢</title>
    <link rel="stylesheet" href="static/style6.css"> <!-- å¼•å…¥CSS -->
    <style>
        .matched {
            background-color: lightgreen;
            font-weight: bold;
            color: black;
            cursor: default;
        }

        /* âœ… ä¿®æ”¹ï¼šæç¤ºéµå›ºå®šå³ä¸Šè§’ */
        #hintButton {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 18px;
            padding: 10px 20px;
            background-color: orange;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #hintButton:disabled {
            background-color: lightgray;
            cursor: not-allowed;
        }

        #timer1 {
            font-size: 20px;
            text-align: center;
            margin-top: 10px;
            display: block;
        }
    </style>
</head>
<body onload="previewAllCards()">
    <div id="timer-container" style="display:none;">
        æ™‚é–“: <span id="timer" style="display:none;">0</span> ç§’<br>
        ç¿»é–‹æé†’æ¬¡æ•¸: <span id="count1">0</span> æ¬¡
    </div>
    <h1 style="font-family: è¯åº·å…’é¢¨é«”W3;text-align: center;"><æ¸¬é©—ç‰ˆ><br>è«‹æ‰¾å‡ºç›¸åŒçš„å…©å¼µåœ–</h1>
    <span id="timer1" style="font-size: 64px; font-weight: bold;text-align: center;display:none;"></span>
    <form>
        <input type="button" class="card-button" id="option1" value="?">
        <input type="button" class="card-button" id="option2" value="?">
        <input type="button" class="card-button" id="option3" value="?">
        <input type="button" class="card-button" id="option4" value="?">
        <input type="button" class="card-button" id="option5" value="?">
        <input type="button" class="card-button" id="option6" value="?">
        <input type="button" class="card-button" id="option7" value="?">
        <input type="button" class="card-button" id="option8" value="?">
    </form>

    <!-- æ–°å¢æç¤ºæŒ‰éˆ• -->
    <button id="hintButton" disabled>æç¤ºéµ</button>

    <div id="gameOverScreen" style="display: none; text-align: center;">
        <h2>æ™‚é–“åˆ°ï¼éŠæˆ²çµæŸï¼</h2>
    </div>

<script>
    var emojis = ['ğŸ', 'ğŸŒ', 'ğŸ', 'ğŸŒ','ğŸ','ğŸ','ğŸ‹','ğŸ‹'];
    var buttons = [];
    for(let i=1; i<=8; i++) {
        buttons.push(document.getElementById("option"+i));
    }

    buttons.forEach((btn, i) => {
        btn.addEventListener("click", function () {
            startGame(btn, i);
        });
    });

    function shuffle(array){
        for(let i=array.length-1;i>0;i--){
            let j = Math.floor(Math.random()*(i+1));
            [array[i], array[j]] = [array[j], array[i]]; //äº’æ›ç‰Œ
        }
        return array;
    }

    let shuffled = shuffle([...emojis]); // è¤‡è£½é¿å…æ±¡æŸ“åŸé™£åˆ—

    var card = [];
    var card2 = [];
    var matchedCount = 0; 
    var count = 0;
    let interval;
    let countdown = 0;
    let isRevealing = false;
    let revealInterval;
    const hintButton = document.getElementById("hintButton");

    // è¼‰å…¥æé†’æ¬¡æ•¸
    if (localStorage.getItem("reminderCount")) {
        count = parseInt(localStorage.getItem("reminderCount"));
    }
    document.getElementById("count1").innerText = count;

    // æç¤ºæŒ‰éˆ•å€’æ•¸è¨ˆæ™‚
    function startHintCountdown() {
        let hintCountdown = 20;
        hintButton.disabled = true;
        hintButton.innerText = `æç¤ºå€’æ•¸ï¼š${hintCountdown}ç§’`;
        const hintTimer = setInterval(() => {
            hintCountdown--;
            hintButton.innerText = `æç¤ºå€’æ•¸ï¼š${hintCountdown}ç§’`;
            if (hintCountdown <= 0) {
                clearInterval(hintTimer);
                hintButton.innerText = "é¡¯ç¤ºæç¤º";
                hintButton.disabled = false;
            }
        }, 1000);
    }

    // é è¦½æ‰€æœ‰å¡ç‰‡ï¼Œ5ç§’è¨˜æ†¶å€’æ•¸
    function previewAllCards() {
        shuffled = shuffle([...emojis]); // æ¯è¼ªé‡æ´—
        buttons.forEach((btn, i) => {
            btn.value = shuffled[i];
            btn.disabled = true;
        });

        let previewCountdown = 5;
        // é›–ç„¶timeréš±è—ï¼Œé‚„æ˜¯ä¿ç•™é¡¯ç¤ºç”¨çš„æ›´æ–°
        document.getElementById("timer1").innerText = "è¨˜æ†¶å€’æ•¸æ™‚é–“:"+previewCountdown;

        const previewInterval = setInterval(() => {
            previewCountdown--;
            document.getElementById("timer1").innerText = "è¨˜æ†¶å€’æ•¸æ™‚é–“:"+previewCountdown;

            if (previewCountdown === 0) {
                clearInterval(previewInterval);
                document.getElementById("timer1").innerText = "éŠæˆ²é–‹å§‹!!!";

                buttons.forEach((btn) => {
                    btn.value = "?";
                    btn.disabled = false;
                });

                // é–‹å§‹æ­£å¼è¨ˆæ™‚
                interval = setInterval(() => {
                    countdown++;
                    document.getElementById("timer").innerText = countdown + " ç§’";
                }, 1000);

                // å•Ÿå‹•æç¤ºå€’æ•¸è¨ˆæ™‚æŒ‰éˆ•
                startHintCountdown();
            }
        }, 1000);
    }

    function startGame(button, index) {
        if (isRevealing) return;  // æç¤ºæœŸé–“ç¦æ­¢ç¿»ç‰Œ
        if (card.length < 2 && !card2.includes(button)) {
            button.value = shuffled[index];
            card.push(shuffled[index]);
            card2.push(button);

            if (card.length === 2) {
                setTimeout(function () {
                    if (card[0] === card[1]) {
                        card2[0].disabled = true;
                        card2[1].disabled = true;

                        card2[0].value = card[0];
                        card2[1].value = card[1];

                        card2[0].classList.add("matched");
                        card2[1].classList.add("matched");

                        matchedCount += 2;

                        if (matchedCount === emojis.length) {
                            clearInterval(interval);
			    localStorage.setItem("reminderTime", countdown);
                            localStorage.setItem("reminderCount", count); // å„²å­˜æé†’æ¬¡æ•¸
                            location.href = "6changecard.html"; // è‹¥æœ‰çµæŸé å¯å–æ¶ˆè¨»è§£
                        }
                    } else {
                        card2[0].value = "?";
                        card2[1].value = "?";
                    }
                    card = [];
                    card2 = [];
                }, 500);
            }
        }
    }

    hintButton.addEventListener("click", () => {
        if (isRevealing) return;  // é¿å…é‡è¤‡é»æ“Š

        isRevealing = true;
        count++;
        document.getElementById("count1").innerText = count;
        localStorage.setItem("reminderCount", count);

        buttons.forEach((btn, index) => {
            if (!btn.classList.contains("matched")) {
                btn.value = shuffled[index];
                btn.disabled = true;
                btn.style.backgroundColor = "#6495ED";
                btn.style.color = "black";
            }
        });

        setTimeout(() => {
            buttons.forEach((btn, index) => {
                if (!btn.classList.contains("matched")) {
                    btn.value = "?";
                    btn.disabled = false;
                    btn.style.backgroundColor = "";
                    btn.style.color = "";
                }
            });
            isRevealing = false;
            startHintCountdown(); // é‡å•Ÿå€’æ•¸è¨ˆæ™‚
        }, 5000);
    });

</script>
</body>
</html>

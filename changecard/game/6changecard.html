<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>éŠæˆ²ä»‹é¢</title>
    <link rel="stylesheet" href="static/style4.css"> <!-- å¼•å…¥CSS -->
</head>
<body onload="previewAllCards()">
    <div id="timer-container">
        æ™‚é–“: <span id="timer2">0</span> ç§’<br>
        ç¿»é–‹æé†’æ¬¡æ•¸: <span id="count2"></span> æ¬¡
    </div>
    <span id="timer1" style="font-size: 64px; font-weight: bold;text-align: center;"></span>
    <form>
        <input type="button" class="card-button" id="option1" value="?">
        <input type="button" class="card-button" id="option2" value="?">
        <input type="button" class="card-button" id="option3" value="?">
        <input type="button" class="card-button" id="option4" value="?">
        <input type="button" class="card-button" id="option5" value="?">
        <input type="button" class="card-button" id="option6" value="?">
        <input type="button" class="card-button" id="option7" value="?">
        <input type="button" class="card-button" id="option8" value="?">
        <input type="button" class="card-button" id="option9" value="?">
        <input type="button" class="card-button" id="option10" value="?">
        <input type="button" class="card-button" id="option11" value="?">
        <input type="button" class="card-button" id="option12" value="?">
    </form>
    <div id="gameOverScreen" style="display: none; text-align: center;">
        <h2>æ™‚é–“åˆ°ï¼éŠæˆ²çµæŸï¼</h2>
      </div>
      <script>
        var i;
        var emojis = ['ğŸ', 'ğŸŒ', 'ğŸ', 'ğŸŒ','ğŸ','ğŸ','ğŸ‹','ğŸ‹','ğŸ‰','ğŸ‰','ğŸ‡','ğŸ‡'];
        var Button = document.getElementById("option1");
        var Button2 = document.getElementById("option2");
        var Button3 = document.getElementById("option3");
        var Button4 = document.getElementById("option4");
        var Button5 = document.getElementById("option5");
        var Button6 = document.getElementById("option6");
        var Button7 = document.getElementById("option7");
        var Button8 = document.getElementById("option8");
        var Button9 = document.getElementById("option9");
        var Button10 = document.getElementById("option10");
        var Button11 = document.getElementById("option11");
        var Button12 = document.getElementById("option12");

        Button.addEventListener("click", function() { startGame(Button, 0); });
        Button2.addEventListener("click", function() { startGame(Button2, 1); });
        Button3.addEventListener("click", function() { startGame(Button3, 2); });
        Button4.addEventListener("click", function() { startGame(Button4, 3); });
        Button5.addEventListener("click", function() { startGame(Button5, 4); });
        Button6.addEventListener("click", function() { startGame(Button6, 5); });
        Button7.addEventListener("click", function() { startGame(Button7, 6); });
        Button8.addEventListener("click", function() { startGame(Button8, 7); });
        Button9.addEventListener("click", function() { startGame(Button9, 8); });
        Button10.addEventListener("click", function() { startGame(Button10, 9); });
        Button11.addEventListener("click", function() { startGame(Button11, 10); });
        Button12.addEventListener("click", function() { startGame(Button12, 11); });

        function shuffle(array){
            for(i=array.length-1;i>0;i--){
                var j = Math.floor(Math.random()*(i+1));
                [array[i], array[j]] = [array[j], array[i]];//äº’æ›ç‰Œ
            }
            return array
        }

        let shuffled = shuffle(emojis)
        let interval;
        var card=[];
        var card2=[];
        var matchedCount = 0; 
        var count; 
        count = parseInt(localStorage.getItem("count1")) || 0;
        document.getElementById("count2").innerText = count;
         function previewAllCards() {
            shuffled = shuffle(emojis)
                const buttons = [Button, Button2, Button3, Button4, Button5, Button6, Button7, Button8, Button9, Button10, Button11, Button12];

                buttons.forEach((btn, i) => {
                    btn.value = shuffled[i];
                    btn.disabled = true;
                });

                let previewCountdown = 5;
                    document.getElementById("timer1").innerText = "è¨˜æ†¶å€’æ•¸æ™‚é–“:"+previewCountdown
                    const previewInterval = setInterval(() => {
                        previewCountdown--;
                        document.getElementById("timer1").innerText = "è¨˜æ†¶å€’æ•¸æ™‚é–“:"+previewCountdown;

                        if (previewCountdown === 0) {
                            clearInterval(previewInterval);
                            document.getElementById("timer1").innerText = "éŠæˆ²é–‹å§‹!!!";


                            // è“‹ç‰Œä¸¦å•Ÿç”¨æŒ‰éˆ•
                            buttons.forEach((btn, i) => {
                                btn.value = "?";
                                btn.disabled = false;
                             });

                         // å•Ÿå‹•æ­£å¼è¨ˆæ™‚
                            let countdown = 0;
                            document.getElementById("timer2").innerText = countdown;
                            interval = setInterval(() => {
                            countdown++;
                            localStorage.setItem("timer2", countdown);
                            document.getElementById("timer2").innerText = countdown;
                            }, 1000);
                        }
                    }, 1000);
            }
        function startGame(button, index) {
                    if (isRevealing) return;  // â¤ å¦‚æœæ­£åœ¨æç¤ºï¼Œå°±ä¸åŸ·è¡Œé»æ“Šé‚è¼¯
                    if (card.length < 2 && !card2.includes(button)) {  // é™åˆ¶æœ€å¤šç¿»å…©å¼µå¡ï¼Œä¸”åŒä¸€æŒ‰éˆ•ä¸èƒ½é»å…©æ¬¡
                        button.value = shuffled[index];
                        card.push(shuffled[index]); // å„²å­˜ emoji
                        card2.push(button);         // å„²å­˜æŒ‰éˆ•
                           
                        if (card.length === 2) {
                            setTimeout(function () {
                                if (card[0] === card[1]) {
                                    card2[0].disabled = true;
                                    card2[1].disabled = true;

                                    card2[0].value = card[0];
                                    card2[1].value = card[1];

                                    card2[0].classList.add("matched");
                                    card2[1].classList.add("matched");

                                    matchedCount += 2;  // âœ… æ¯æ¬¡æˆåŠŸé…å°åŠ  2

                                    // âœ… è‹¥æ‰€æœ‰ç‰Œéƒ½é…å°æˆåŠŸï¼Œå°±å°å‘çµæœé 
                                    if (matchedCount === emojis.length) {
                                        clearInterval(interval);  // åœæ­¢å€’æ•¸
                                        clearInterval(revealInterval);
                                        window.location.href = "/changecarddone4";
                                    }
                                } else {
                                    card2[0].value = "?";
                                    card2[1].value = "?";
                                }
                                card2 = [];
                                card = [];//é‡ç½®
                            }, 500);  // ç­‰å¾… 1 ç§’å¾Œæª¢æŸ¥æ˜¯å¦é…å°
                        }
                    }
                }
                let revealInterval = setInterval(revealAllCards, 25000);
                let isRevealing = false;  // â¤ åŠ é€™å€‹è®Šæ•¸
                function revealAllCards() {
                    isRevealing = true; // â¤ é–‹å§‹æç¤ºæ™‚ï¼Œç¦æ­¢é»æ“Š
                    let buttons = document.querySelectorAll(".card-button");
                    count = count+1;
                    document.getElementById("count2").innerText = count;
                    localStorage.setItem("count2", count);
                    // æ­ç¤ºæœŸé–“ï¼Œå…¨éƒ¨æŒ‰éˆ•ç¦ç”¨ï¼ˆç„¡æ³•é»æ“Šï¼‰
                    buttons.forEach(btn => {
                        btn.disabled = true;
                        
                    });

                    // é¡¯ç¤ºæ‰€æœ‰æœªé…å°å¡ç‰‡
                    buttons.forEach((btn, index) => {
                        if (!btn.classList.contains("matched")) {
                            btn.dataset.index = index; // âœ… å­˜ä¸‹æ­£ç¢ºçš„ index
                            btn.value = shuffled[index];
                            
                            btn.style.backgroundColor = "#6495ED";  // æˆ–ä½ åŸæœ¬çš„èƒŒæ™¯è‰²
                            btn.style.color = "black";
                            btn.style.opacity = "1";
                            btn.style.border = "1px solid #999";
                            btn.style.cursor = "default";
                        }
                    });

                    // 5ç§’å¾Œè“‹å›æœªé…å°å¡ç‰‡ï¼Œä¸¦é–‹æ”¾é»æ“Š
                    setTimeout(() => {
                        buttons.forEach(btn => {
                            if (!btn.classList.contains("matched")) {
                                btn.value = "?";
                                btn.disabled = false;
                                
                                btn.style.backgroundColor = ""; 
                                btn.style.color = "";
                                btn.style.opacity = "";
                                btn.style.border = "";
                                btn.style.cursor = "";
                            } else {
                                btn.disabled = true;
                                // âœ… ä½¿ç”¨äº‹å…ˆå„²å­˜çš„ index
                                let idx = btn.dataset.index;
                                if (idx !== undefined) {
                                    btn.value = shuffled[idx];
                                }
                            }
                        });
                        isRevealing = false; // â¤ æç¤ºçµæŸï¼Œå…è¨±é»æ“Š
                    }, 5000);
            }
        buttons.forEach((btn, i) => {
            btn.addEventListener("click", () => startGame(btn, i));
        });

        window.onload = previewAllCards;
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>éŠæˆ²ä»‹é¢</title>
    <link rel="stylesheet" href="static/style4.css" />
    <style>
        .matched {
            background-color: lightgreen;
            font-weight: bold;
            color: black;
            cursor: default;
        }

        #hintButton {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 18px;
            padding: 10px 20px;
            background-color: orange;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #hintButton:disabled {
            background-color: lightgray;
            cursor: not-allowed;
        }

        #timer1 {
            font-size: 64px;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            display: none;
        }

        #timer2 {
            font-size: 20px;
            text-align: center;
            margin-top: 10px;
            display: block;
        }
    </style>
</head>
<body onload="previewAllCards()">

    <div id="timer-container" style="display:none;">
        æ™‚é–“: <span id="timer2">0</span> ç§’<br />
        ç¿»é–‹æé†’æ¬¡æ•¸: <span id="count2">0</span> æ¬¡
    </div>
    <h1 style="font-family: è¯åº·å…’é¢¨é«”W3;text-align: center;"><æ¸¬é©—ç‰ˆ><br>è«‹æ‰¾å‡ºç›¸åŒçš„å…©å¼µåœ–</h1>
    <span id="timer1"></span>

    <form>
        <!-- 16 å¼µå¡ç‰‡ -->
        <input type="button" class="card-button" id="option1" value="?" />
        <input type="button" class="card-button" id="option2" value="?" />
        <input type="button" class="card-button" id="option3" value="?" />
        <input type="button" class="card-button" id="option4" value="?" />
        <input type="button" class="card-button" id="option5" value="?" />
        <input type="button" class="card-button" id="option6" value="?" />
        <input type="button" class="card-button" id="option7" value="?" />
        <input type="button" class="card-button" id="option8" value="?" />
        <input type="button" class="card-button" id="option9" value="?" />
        <input type="button" class="card-button" id="option10" value="?" />
        <input type="button" class="card-button" id="option11" value="?" />
        <input type="button" class="card-button" id="option12" value="?" />
        <input type="button" class="card-button" id="option13" value="?" />
        <input type="button" class="card-button" id="option14" value="?" />
        <input type="button" class="card-button" id="option15" value="?" />
        <input type="button" class="card-button" id="option16" value="?" />
    </form>

    <button id="hintButton" disabled>æç¤ºéµ</button>

    <div id="gameOverScreen" style="display: none; text-align: center;">
        <h2>æ™‚é–“åˆ°ï¼éŠæˆ²çµæŸï¼</h2>
    </div>

<script>
    const emojis = ['ğŸ','ğŸŒ','ğŸ','ğŸŒ','ğŸ','ğŸ','ğŸ‹','ğŸ‹','ğŸ‰','ğŸ‰','ğŸ‡','ğŸ‡','ğŸ“','ğŸ“','ğŸ’','ğŸ’'];
    const buttons = [];
    for(let i=1; i<=16; i++){
        buttons.push(document.getElementById('option'+i));
    }

    buttons.forEach((btn, i) => {
        btn.addEventListener('click', () => startGame(btn, i));
    });

    function shuffle(array){
        for(let i=array.length-1; i>0; i--){
            let j = Math.floor(Math.random()*(i+1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    let shuffled = shuffle([...emojis]);  // è¤‡è£½ä¸¦æ´—ç‰Œ
    let card = [];
    let card2 = [];
    let matchedCount = 0;
    let count;  // æç¤ºæ¬¡æ•¸
    let interval;
    let countdown = 0;
    let isRevealing = false;
    const hintButton = document.getElementById('hintButton');

    // è¼‰å…¥æé†’æ¬¡æ•¸ä¸¦æ›´æ–°ç•«é¢
    if(localStorage.getItem('reminderCount')){
        count = parseInt(localStorage.getItem('reminderCount'));
    }
    document.getElementById('count2').innerText = count;

    function startHintCountdown(){
        let hintCountdown = 20;
        hintButton.disabled = true;
        hintButton.innerText = `æç¤ºå€’æ•¸ï¼š${hintCountdown}ç§’`;

        const hintTimer = setInterval(() => {
            hintCountdown--;
            hintButton.innerText = `æç¤ºå€’æ•¸ï¼š${hintCountdown}ç§’`;
            if(hintCountdown <= 0){
                clearInterval(hintTimer);
                hintButton.innerText = "é¡¯ç¤ºæç¤º";
                hintButton.disabled = false;
            }
        }, 1000);
    }

    function previewAllCards(){
        shuffled = shuffle([...emojis]);
        buttons.forEach((btn, i) => {
            btn.value = shuffled[i];
            btn.disabled = true;
        });

        let previewCountdown = 5;
        const timer1 = document.getElementById('timer1');
        timer1.style.display = 'block';
        

        const previewInterval = setInterval(() => {
            previewCountdown--;

            if(previewCountdown === 0){
                clearInterval(previewInterval);

                buttons.forEach(btn => {
                    btn.value = "?";
                    btn.disabled = false;
                });

                countdown = 0;
                document.getElementById('timer2').innerText = countdown;

                interval = setInterval(() => {
                    countdown++;
                    document.getElementById('timer2').innerText = countdown;
                }, 1000);

                startHintCountdown();
            }
        }, 1000);
    }

    function startGame(button, index){
        if(isRevealing) return;
        if(card.length < 2 && !card2.includes(button)){
            button.value = shuffled[index];
            card.push(shuffled[index]);
            card2.push(button);

            if(card.length === 2){
                setTimeout(() => {
                    if(card[0] === card[1]){
                        card2[0].disabled = true;
                        card2[1].disabled = true;
                        card2[0].classList.add('matched');
                        card2[1].classList.add('matched');

                        matchedCount += 2;

                        if(matchedCount === emojis.length){
                            clearInterval(interval);
                            localStorage.setItem("reminderTime3", countdown);
			    localStorage.setItem('reminderCount', count);
                            location.href = '../changecardend.html'; // éŠæˆ²çµæŸè·³è½‰é é¢
                        }
                    } else {
                        card2[0].value = "?";
                        card2[1].value = "?";
                    }
                    card = [];
                    card2 = [];
                }, 500);
            }
        }
    }

    hintButton.addEventListener('click', () => {
        if(isRevealing) return;

        isRevealing = true;
        count++;
        document.getElementById('count2').innerText = count;
        localStorage.setItem('reminderCount', count);

        buttons.forEach((btn, index) => {
            if(!btn.classList.contains('matched')){
                btn.value = shuffled[index];
                btn.disabled = true;
                btn.style.backgroundColor = '#6495ED';
                btn.style.color = 'black';
            }
        });

        setTimeout(() => {
            buttons.forEach((btn, index) => {
                if(!btn.classList.contains('matched')){
                    btn.value = "?";
                    btn.disabled = false;
                    btn.style.backgroundColor = '';
                    btn.style.color = '';
                }
            });
            isRevealing = false;
            startHintCountdown();
        }, 5000);
    });
</script>
</body>
</html>
